<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Required link tags -->
        <link rel="stylesheet" href="/static/css/bootstrap.min.css">
        <link rel="stylesheet" href="/static/css/bootstrap-grid.min.css">
        <link rel="stylesheet" href="/static/css/bootstrap-reboot.min.css">
        <link rel="stylesheet" href="/static/font/css/open-iconic-bootstrap.css">
        <link rel="stylesheet" href="/static/css/c3.min.css">
        <!-- Required script tags -->
        <script src="/static/js/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
        <script src="/static/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="/static/js/vue_2.6.12.js"></script>
        <script src="/static/js/vuejs-pagenate_2.1.0.js"></script>
        <script src="/static/js/d3.v5.min.js"></script>
        <script src="/static/js/c3.min.js"></script>

        <!-- My Custom script tags -->
        <script type="text/javascript">
            function test(){
                null;
            }
        </script>
        <title>体温測定</title>
    </head>
    <body>
        <div class="container" id="app">
            <div class="row">
                <div class="col-6">
                    <table class="table table-hover table-stripe table-bordered table-md">
                        <thead class="thead-dark">
                            <th>測定日</th>
                            <th>測定結果</th>
                        </thead>
                        <tbody>
                            <tr v-for="item in items">
                                <td>[[item.MEASURE_DATE]]</td>
                                <td>[[item.MEASURE_RESULT]]</td>
                            </tr>
                        </tbody>
                    </table>
                    <paginate
                        :page-count="getPageCount"
                        :page-range="3"
                        :margin-pages="2"
                        :click-handler="clickCallback"
                        :prev-text="'PREV'"
                        :next-text="'NEXT'"
                        :container-class="'pagination'"
                        :page-class="'page-item user-select-none'"
                        :page-link-class="'page-link'"
                        :prev-class="'page-item user-select-none'"
                        :prev-link-class="'page-link'"
                        :next-class="'page-item user-select-none'"
                        :next-link-class="'page-link'"
                        >
                    </paginate>
                </div>
                <div class="col-12">
                    <div id="chart"></div>
                </div>
            </div>
        </div>
        <script>
            var items = [];
            var measure_date_list = ["日付"]
            var measure_result_list = ["測定結果"]
            //1ページあたりに表示するデータ数
            var par_page = 5;
            {% if measure_list != None %}
                {% for measure in measure_list %}
                    items.push({"MEASURE_DATE":"{{measure.MEASURE_DATE}}"
                               ,"MEASURE_RESULT":"{{measure.MEASURE_RESULT}}" + "℃"
                               });
                    measure_date_list.push("{{measure.MEASURE_DATE}}")
                    measure_result_list.push("{{measure.MEASURE_RESULT}}")
                {% endfor %}
            {% endif %}
            //最後のページの件数がpar_page未満になる場合は空データを作成
            if(items.length % par_page > 0){
                for(var i=0; i < items.length % par_page; i++){
                    items.push({"MEASURE_DATE":"　"
                               ,"MEASURE_RESULT":"　"
                               });
                }
            }
            Vue.component('paginate', VuejsPaginate)
            Vue.filter('br_to_lf', function (value) {
                var regexp = /&lt;br&gt;/g;
                return value.replace(regexp, '\n');
            })
            new Vue({
                el: '#app',
                delimiters: ["[[", "]]"],
                data: {
                    items: items,
                    parPage: par_page,
                    currentPage: 1
                },
                methods: {
                    clickCallback: function (pageNum) {
                        this.currentPage = Number(pageNum);
                    }
                },
                computed: {
                    getItems: function() {
                        let current = this.currentPage * this.parPage;
                        let start = current - this.parPage;
                        return this.items.slice(start, current);
                    },
                    getPageCount: function() {
                        return Math.ceil(this.items.length / this.parPage);
                    }
                }
            })
            var chart = c3.generate({
                bindto: '#chart',
                padding: {
                    top: 20, right: 40, bottom: 20, left: 100
                },
                data: {
                    type: 'bar', // 棒グラフ
                    columns: [ // データ
                        measure_date_list,
                        measure_result_list
                    ],
                    x: '日付', // データ x を x軸ラベルにする
                    xFormat: '%Y%m%d%H%M%S' // X軸の元の書式 (%Y/%m/%d %H:%M:%S など)
                },
                bar: {
                    width: {
                        ratio: 0.5,
                    }
                },
                axis: {
                    x: {
                        type: 'category', // 時間として指定
                        // X軸ラベル
                        label: {
                            text: '日付',
                            position: 'outer-center'
                        },
                        tick: {
                            culling: false, // x軸ラベルの途中省略をしない
                            format: '%Y/%m' // X軸の表示書式 (%Y/%m/%d %H:%M:%S など)
                        },
                    },
                    y: {
                        // Y軸ラベル
                        label: {
                            text: '体温',
                            position: 'outer-middle'
                        },
                        tick: {
                            format: function (d) {
                                     return new Intl.NumberFormat('ja').format(d) + "℃"; } // Y軸ラベルの書式
                        },
                    }
                },
                grid: {
                    y: {
                        show: true // Y軸グリッド表示
                    }
                },
                legend: {
                    show: false // 凡例非表示
                },
            });
        </script>
    </body>
</html>